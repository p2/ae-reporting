<form class="process_form" id="form_demographics">
	<% var full_name = 'Unknown';
	var demo = ('demographics' in data) ? data['demographics'] : {};
	if ('vcard:n' in demo) {
		var n = demo['vcard:n'];
		full_name = (('vcard:family-name' in n) ? n['vcard:family-name'] : 'Unknown') + ', ' + (('vcard:given-name' in n) ? n['vcard:given-name'] : '')
	}
	var gender = ('foaf:gender' in demo) ? demo['foaf:gender'] : null;
	%>
	<h4><%= full_name %></h4>
	
	<div class="patient_portrait">
		<img src="static/portrait_default.png" alt="" /><br />
		<input id="gender_female" type="radio" name="gender" value="w" <%= ('female' == gender) ? 'checked="checked"' : '' %> />
		<label for="gender_female">Female</label>
		<input id="gender_male" type="radio" name="gender" value="m" <%= ('male' == gender) ? 'checked="checked"' : '' %> />
		<label for="gender_male">Male</label>
	</div>
	
	<div class="process_block">
		<h5>Patient Identifier</h5>
		<input type="text" placeholder="Kept confidential" size="30" /><br />
		<span class="small faded">We will use this identifier for follow up</span>
	</div>
	
	<% var bday = null;
	var age = '';
	var deathdate = null;
	if ('vcard:bday' in demo) {
		bday = moment(demo['vcard:bday']);
		if (bday) {
			age = moment().diff(bday, 'years');
			if (age < 3) {
				age = moment().diff(bday, 'months');
			}
		}
	} 
	if ('vcard:deathdate' in demo) {
		deathdate = moment(demo['vcard:deathdate']);
	} %>
	<div class="process_block">
		<table>
			<tr>
				<td>
					<h5>Date of Birth</h5>
					<input class="auto-kal" type="text" name="bday" placeholder="MM/DD/YYYY" data-kal="format: 'MM/DD/YYYY'" value="<%= bday ? bday.format('MM/DD/YYYY') : '' %>" />
				</td>
				<td style="vertical-align:middle; padding:1em 2em;">or</td>
				<td>
					<h5>Age <span class="small faded">at time of event</span></h5>
					<input type="text" name="age" placeholder="<%= age %>" size="4" /> <label>years</label><br />
					
				</td>
			</tr>
		</table>
	</div>
	
	<div class="process_block">
		<h5>Date of Death</h5>
		<input id="death_date" class="auto-kal" type="text" name="deathdate" placeholder="MM/DD/YYYY" data-kal="format: 'MM/DD/YYYY'" value="<%= deathdate ? deathdate.format('MM/DD/YYYY') : '' %>" />
	</div>
		
	<div class="process_row">
		<h5>Ethnicity</h5>
		<input type="text" name="ethnicity" value="<%= ('sp:ethnicity' in demo) ? demo['sp:ethnicity'] : '' %>" />
	</div>
	
	<div class="process_row">
		<% var weight = '';
		var measured = null;
		var vitals = ('vitals' in data) ? data['vitals'] : {};
		for (var i = 0; i < vitals.length; i++) {
			var vital = vitals[i];
			if ('sp:weight' in vital) {
				var val = vital['sp:weight']['sp:value'];
				val = Math.round(10 * val) / 10;
				weight = val + ' ' + vital['sp:weight']['sp:unit'];
				if ('dcterms:date' in vital) {
					measured = moment(vital['dcterms:date']);
				}
				break;
			}
		} %>
		<h5>Weight</h5>
		<input type="text" name="weight" value="<%= weight %>" size="10" />
		<span class="small faded"><%= measured ? 'Measured: ' + measured.format('ll') : '' %></span>
	</div>
</form>
