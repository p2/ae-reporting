<form class="process_form" id="form_demographics">
	<table>
		<tbody>
			<% var full_name = 'Unknown';
			if ('vcard:n' in data) {
				var n = data['vcard:n'];
				full_name = (('vcard:family-name' in n) ? n['vcard:family-name'] : 'Unknown') + ', ' + (('vcard:given-name' in n) ? n['vcard:given-name'] : '')
			}
			%>
			<tr><th>Patient:</th><td><h4><%= full_name %></h4></td></tr>
			<tr>
				<th class="row_section_end">Patient Identifier:</th>
				<td class="row_section_end">
					<input type="text" placeholder="Kept confidential" size="30" /><br />
					<span class="small faded">We will use this identifier should we need to follow up with you</span>
				</td>
			</tr>
			
			<% var bday = null;
			var age = '';
			var deathdate = null;
			var gender = ('foaf:gender' in data) ? data['foaf:gender'] : null;
			if ('vcard:bday' in data) {
				bday = moment(data['vcard:bday']);
				if (bday) {
					age = moment().diff(bday, 'years');
				}
			} 
			if ('vcard:deathdate' in data) {
				deathdate = moment(data['vcard:deathdate']);
			} %>
			<tr>
				<th class="row_section_begin">Date of Birth:</th>
				<td class="row_section_begin">
					<input class="auto-kal" type="text" name="bday" placeholder="MM/DD/YYYY" data-kal="format: 'MM/DD/YYYY'" value="<%= bday ? bday.format('MM/DD/YYYY') : '' %>" />
				</td>
			</tr>
			<tr><th></th><td><b>or</b></td></tr>
			<tr>
				<th class="row_section_end">Age:</th>
				<td class="row_section_end">
					<input type="text" name="age" placeholder="<%= age %>" size="4" /> <label>years</label>
					<span class="small faded">(at time of event)</span>
				</td>
			</tr>
			
			<tr>
				<th class="row_section_begin row_section_end">Date of Death:</th>
				<td class="row_section_begin row_section_end">
					<input class="auto-kal" type="text" name="deathdate" placeholder="MM/DD/YYYY" data-kal="format: 'MM/DD/YYYY'" value="<%= deathdate ? deathdate.format('MM/DD/YYYY') : '' %>" />
				</td>
			</tr>
			
			<tr>
				<th class="row_section_begin">Gender:</th>
				<td class="row_section_begin">
					<input id="gender_female" type="radio" name="gender" value="w" <%= ('female' == gender) ? 'checked="checked"' : '' %> />
					<label for="gender_female">Female</label>
					<input id="gender_male" type="radio" name="gender" value="m" <%= ('male' == gender) ? 'checked="checked"' : '' %> />
					<label for="gender_male">Male</label>
				</td>
			</tr>
			<tr><th>Ethnicity:</th><td><input type="text" name="ethnicity" value="<%= ('sp:ethnicity' in data) ? data['sp:ethnicity'] : '' %>" /></td></tr>
			
			<% var weight = '';
			var measured = null;
			for (var i = 0; i < data.vitals.length; i++) {
				var vital = data.vitals[i];
				if ('sp:weight' in vital) {
					var val = vital['sp:weight']['sp:value'];
					val = Math.round(10 * val) / 10;
					weight = val + ' ' + vital['sp:weight']['sp:unit'];
					if ('dcterms:date' in vital) {
						measured = moment(vital['dcterms:date']);
					}
					break;
				}
			} %>
			<tr>
				<th>Weight:</th>
				<td>
					<input type="text" name="weight" value="<%= weight %>" size="10" />
					<span class="small faded"><%= measured ? 'Measured: ' + measured.format('ll') : '' %></span>
				</td>
			</tr>
		</tbody>
	</table>
</form>
