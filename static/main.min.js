function _runRule(e,t){if(!_ruleCtrl){alert("There is no rule controller, cannot run rule!");return}_ruleCtrl.runRule(e,t)}var _ruleCtrl=null,_globals={};$(document).ready(function(){window!=window.top&&$("#back_to_patient_select").hide();_ruleCtrl=new RuleController;_ruleCtrl.fetchRules()});var Rule=Base.extend({name:"",description:"",constructor:function(e){for(var t in e)this[t]=e[t]},run:function(e){var t=this,n=$(e);n.text("Running...").attr("disabled",!0);$.ajax("rules/"+t.id+"/run_against/"+_record_id+"?api_base="+_api_base,{success:function(e){var t=n.parent().find(".rule_output").first();n.text("Check").removeAttr("disabled");if(0==e)t.is("*")?t.empty().html('<h3 class="green">No match</h3>'):alert("The rule did not match");else if(t.is("*")){t.empty().append('<h3 class="red">The rule did match</h3>').append("<pre/>");t.find("pre").first().text(e)}else alert("The rule did match");var r=$("#num_previous_checks");r.text(r.text()*1+1)},error:function(e,r,i){var s=n.parent().find(".rule_output").first();n.text("Try again").removeAttr("disabled");s.is("*")?s.empty().html('<h3 class="red">Failed to run rule '+t.name+": "+i+"</h3>"):alert("Failed to run rule "+t.name+": "+i)}})}}),RuleController=Base.extend({loaded:!1,rules:[],fetchRules:function(){var e=this;$.get("rules/?api_base="+_api_base+"&record_id="+_record_id,function(t){if(t){var n=[];for(var r=0;r<t.length;r++)n.push(new Rule(t[r]));e.rules=n;e.loaded=!0;e.showRules()}else{alert('Invalid response for "rules/"');console.log("rules",t)}},"json")},showRules:function(){$("#rules").html("templates/rules.ejs",{rules:this.rules})},runRule:function(e,t){var n=null;for(var r=0;r<this.rules.length;r++)if(t==this.rules[r].id){n=this.rules[r];break}if(!n){alert("We don't have the rule \""+t+'"');return}n.run(e)}});